# 8. Log Stream

Referensi: https://help.qlik.com/en-US/replicate/May2025/Content/Replicate/Main/Log%20Stream%20Staging/intro.htm

## Overview

Log stream merupakan salah satu fitur dari jenis task yang ada di qlik replicate dimana setiap changes atau perubahan dari transaction log yang ada di sumber / source endpoint disimpan dalam suatu direktori/folder terpisah yang disebut __staging folder__. Dari hasil penyimpanannya kemudian dapat digunakan untuk membuat task replikasi ke satu atau lebih target endpoint. 

Dengan hal tersebut maka terdapat sejumlah keuntungan yang bisa di dapat yakni antara lain:

- Efisiensi Tinggi

Jika sebelumnya setiap target endpoint harus membaca log secara terpisah, sekarang cukup sekali baca log dari sumber, lalu bisa digunakan oleh banyak target. Ini sangat membantu jika sumber log-nya besar/berat atau digunakan bersama, seperti pada beberapa jenis database yakni Oracle dan DB2.

- Mengurangi Beban di Sumber Database

Karena hanya satu proses yang membaca log, maka sumber database dan jaringan tidak terlalu terbebani.

- Bebas Ketergantungan pada Ketersediaan Target

Setiap perubahan tetap disimpan ke staging folder meskipun target sedang offline ataupun task replikasi ke suatu target di stop. Ketika target kembali online atau task di running, proses replikasi lebih cepat cepat karena tidak perlu ambil log ulang dari sumber.

- Tidak Perlu Menyimpan Log Lama di Sumber

Umumnya, jika target offline, log di sumber harus disimpan lama. Namun dengan Log Stream, ini tidak perlu lagi karena semua perubahan sudah ada di server Replicate yang disimpan di staging folder.

- Fleksibilitas Replikasi

Setiap target bisa mereplikasi subset data yang berbeda juga dapat jalan secara independen (start/stop/schedule) tanpa bergantung pada target lain.

## Alur Log Stream

Dapat dilihat pada gambar dibawah bagaimana alur pada log stream bekerja sehingga proses CDC atau singkronisasi perubahan menjadi efisien. Namun Jika ingin melakukan full load pada target baru, tetap dilakukan dengan mengambil secara langsung ke source, bukan dari log stream yang hanya fokus pada proses CDC/apply changes saja.

<img width="1272" height="469" alt="image" src="https://github.com/user-attachments/assets/cbfb1c9b-0608-47a7-b787-4481323f5f30" />

## Step by Step

Pada dokumentasi ini, akan dibuat satu contoh penggunaan log stream dengan MySQL sebagai source endpoint nya, kemudian dibuat satu task bernama `Log Stream Staging Task` dengan menerapkan log streaming untuk menyimpan changes dari source endpoint MySQL ke direktory local replicate server. Dari situ kemudian dibuat source baru bernama `mysql with Log Stream` yang berjalan berdasarkan source endpoint MySQL yang sebelumnya serta berdasarkan task log stream `Log Stream Staging Task`.

Dari source `mysql with Log Stream` lah kemudian akan dibuat replication task ke target yang diinginkan yang dalam percobaan kali ini dibuat dua task ke dua instance database PostgreSQL yang berbeda. Sebut saja `Postgres 1` dan `Postgres 2`.

<img width="1321" height="629" alt="image" src="https://github.com/user-attachments/assets/25ddb298-5cd2-4038-8668-3bc4799aef62" />

### 1. Buat Log Stream Target Endpoint

referensi: https://help.qlik.com/en-US/replicate/May2025/Content/Replicate/Main/Log%20Stream%20Staging/ls2.htm

Hal ini berguna untuk mendefinisikan tujuan dimana transaction log dari database source di simpan dalam direktori local replicate server. Berikut adalah contoh dari pembuatan target endpoint untuk log stream nya. Coba Jalankan `test connection` untuk memastikan konfigurasi sudah sesuai lalu save.

<img width="1001" height="817" alt="image" src="https://github.com/user-attachments/assets/e49bcce0-2079-4e1e-98ab-1782cdf1ac49" />

Seharusnya setelah itu tergenerate staging folder ditempat yang di define sebelumnya:

<img width="1236" height="781" alt="image" src="https://github.com/user-attachments/assets/7c5cfd29-9c16-45d6-bf9e-1b8d3986b967" />

### 2. Membuat dan Jalankan Log Stream Staging Task

referensi: https://help.qlik.com/en-US/replicate/May2025/Content/Replicate/Main/Log%20Stream%20Staging/ls3.htm

Selanjutnya buat sebuah task baru dengan memilih tipe replikasi log stream, pilih source endpoint MySQL, kemudian targetnya arahkan ke `Log Stream Target Endpoint` yang sudah di buat pada step pertama diatas.

<img width="361" height="331" alt="image" src="https://github.com/user-attachments/assets/45f6197f-0517-4127-be89-ee6caebcd27f" />

Pilih dan sesuaikan tabel yang ingin di replikasi kemudian RUN task nya.

### 3. Duplikasi source endpoint dan mengaitkannya ke log stream staging task.

referensi: https://help.qlik.com/en-US/replicate/May2025/Content/Replicate/Main/Log%20Stream%20Staging/ls4.htm#anchor-1

Masuk ke `manage endpoint connection` lalu duplikasi source endpoint MySQL dan rename nama nya, lakukan simpan dengan klik tombol `save`.

Jika sudah di save maka nanti terdapat check box bertuliskan `Read changes from log stream staging folder`, ceklis itu dan pilih Log stream staging task nya ke arah task yang sudah dibuat di step kedua diatas. Masukan kembali password dari user database nya dan test connection, pastikan sudah terkoneksi dengan baik dan save kembali. Dalam percobaan ini nama source nya dinamakan `mysql with Log Stream`

<img width="1002" height="823" alt="image" src="https://github.com/user-attachments/assets/88075101-036c-42eb-b3e9-ccda2420c7b3" />

### 4. Buat task baru dengan mengarahkan ke target endpoint

referensi: https://help.qlik.com/en-US/replicate/May2025/Content/Replicate/Main/Log%20Stream%20Staging/ls4.htm#anchor-2

Create task baru, pilih source nya dari source yang dibuat pada step 3 diatas `mysql with Log Stream`, lalu pilih targetnya ke endpoint target yang diinginkan, dalam percobaan ini ke `Postgres 1`. Kemudian pilih table yang diinginkan, save dan jalankan task nya.

Dengan process yang sama, dibuat juga task kedua yang menggunakan source `mysql with Log Stream` dan ditujukan ke target endpoint `Postgres 2`, simpan lalu run task juga.

<img width="446" height="539" alt="image" src="https://github.com/user-attachments/assets/8796b143-9ea7-4859-8006-549ce8e5e55b" />
<img width="392" height="542" alt="image" src="https://github.com/user-attachments/assets/b8420c7b-0065-4e46-b0e7-0e7ad41598da" />

Jika semua sudah dilakukan maka seharusnya terdapat tiga task yang running yakni task untuk replikasi transaction log ke staging folder serta dua task untuk replikasi dari staging folder ke dua target endpoint yang berbeda (postgres 1 dan postgres 2).

Task to replicate from source to staging folder
![WhatsApp Image 2025-08-06 at 14 09 51_ddf025de](https://github.com/user-attachments/assets/2e04f2a4-9984-460f-8060-3813805ce333)

Task to replicate from staging folder to postgres 1
![WhatsApp Image 2025-08-06 at 14 10 09_1a255a27](https://github.com/user-attachments/assets/15ee2d8d-c598-48ee-8cda-1e244e38bed2)

Task to replicate from staging folder to postgres 2
![WhatsApp Image 2025-08-06 at 14 10 22_0a19eed7](https://github.com/user-attachments/assets/d2dd009f-6b76-4b49-b46b-9c0d4ef866cc)

Setelah running, dilakukan percobaan untuk insert, update dan delete pada database source MySQL, dapat dilihat bahwa target endpoint yakni Postgres 1 dan Postgres 2 dapat melakukan singkronisasi berdasarkan perubahan yang dilakukan. __Sisi kiri__ dari source __MySQL__, __sisi tengah__ dari target __postgres 1__ dan __sisi kanan__ dari __postgres 2__.

![WhatsApp Image 2025-08-06 at 14 06 41_68792d6c](https://github.com/user-attachments/assets/4336141f-fc79-43d9-9822-faa683a6ff9f)
